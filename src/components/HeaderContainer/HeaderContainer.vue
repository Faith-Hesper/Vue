<template>
  <!-- <el-header> -->
  <div class="search">
    <span class="example-demonstration">搜索: </span>
    <el-cascader
      v-model="searchArea"
      placeholder="搜索"
      :show-all-levels="false"
      :clearable="true"
      :props="prop"
      :options="province_list"
      @change="searchBtn"
      filterable    

    />
  </div>
  <div class="header">Header</div>
  <!-- :filter-method="filterMethod" -->
  <!-- </el-header> -->
</template>

<script setup>
import { onMounted, ref, reactive, shallowReactive } from 'vue'
import { province_list, city_list, county_list } from '@/utils/areaListPrimary'
import { ponit,earthPoint,Chart } from '@/utils/map'
import getCoordsPoint from '@/utils/getCoordsPoint'
import { earthquake } from '@/api/base'

const searchArea = ref('110000')
const prop = reactive({
  // expandTrigger: 'hover',
  loading: false,
  checkStrictly: true, // 取消父子节点关联
  emitPath: false,
  lazy: true,
  lazyLoad(node, resolve) {
    const { level, value } = node
    if (level == 0) {
      resolve(province_list)
    } else if (level == 1) {
      let citys = city_list.filter((item) => {
        // 市前两位与省前两位相同
        if(item.value.slice(0, 2) == value.slice(0, 2))
        {
          province_list.children = item
          return true
        }
      })
      resolve(citys)
    } else if (level == 2) {
      let countys = county_list.filter((item) => {
        // 县前两位与市前两位相同
        if(item.value.slice(0, 2) == value.slice(0, 2) && item.value.slice(3, 4) == value.slice(3, 4)){
          city_list.children = item
          return true
        }
      })
      countys.forEach((item) => {
        item.leaf = true
      })
      resolve(countys)
    }
  },
})

const searchBtn = async (value) => {
  let points = await getCoordsPoint(1, value)
  await ponit(points)
}

const formDate = (time)=>{
  if(time<=9){
    return '0' + time
  }
  return time.toString()
}

onMounted(async () => {
  // dataPro()
  const { data:{ result } } = await earthquake()
  let reverseDate = result.reverse()
  await earthPoint(reverseDate)
  let sevenAgoTime = []
  let nowTime = new Date()
  for(let i=0;i<7;i++){
    let timestamp =new Date()
    timestamp.setDate(nowTime.getDate()-i)
    let formtime = formDate(timestamp.getMonth()+1) + formDate(timestamp.getDate())
    sevenAgoTime.push(formtime)
    // console.log(sevenAgoTime)
  }
  let echarts = {
    time: [],
    count: []
  }
  sevenAgoTime.map(item=>{
    let time = item
    let earthquakeCount = 0
    reverseDate.map((item,index)=>{
      let earthquakeTime = item.CATA_ID.slice(6,10)
      if(time == earthquakeTime)
      {
        earthquakeCount++
      }
    })
    echarts.time.push(item)
    echarts.count.push(earthquakeCount)
  })
  Chart(echarts)
  console.log(echarts);
  // console.log(result)
})

</script>

<script>
export default {
  name: 'Header'
}
</script>

<style scoped>
.search {
  /* position: absolute; */
  /* order: -5; */
  /* text-align: left; */
  padding-left: 5%;
  left: 20%;
}
.header{
  left: 50%;
  position: absolute;
}
</style>
